- 参考书目：modern Cmake for C++(github开源，陈晓伟 译)

# 1. 基础语法
## 1.1 cmake

### 1.1.1 构建与编译

```Bash
cmake -B dir_tree -S source_dir
# -B 指定构建目录，不存在则创建 -S指定源码目录
cmake --build dir_tree
#使用刚生成的cmake构建工程来编译，编译产物将放在 dir_tree目录
```
## 1.2 CmakeList.txt
### 1.2.1 常用模板
- ```cmake
		cmake_minimum_required(VERSION 3.17)  #指定Cmake最低版本
		project(gcx_muduo)  
		  
		# C++ 标准配置  
		set(CMAKE_CXX_STANDARD 20)  
  
		# 输出路径（自动创建）  
		set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)  
		set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)  
		file(MAKE_DIRECTORY ${LIBRARY_OUTPUT_PATH} ${EXECUTABLE_OUTPUT_PATH})  
		  
		# 编译选项  
		set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g  -fPIC -pthread")  
		  
		# 配置你的库的公开头文件路径（使用者需要）
		set(PUBLIC_INCLUDE_DIR ${PROJECT_SOURCE_DIR}/include)
		include_directories(${PUBLIC_INCLUDE_DIR})  # 你的代码能找到自己的头文件

		# 递归扫描：根目录 + src 所有子目录的 .c/.cpp  
		file(GLOB_RECURSE SRC_LIST  
		        CONFIGURE_DEPENDS  
		        ${PROJECT_SOURCE_DIR}/*.c  
		        ${PROJECT_SOURCE_DIR}/*.cpp  
		        ${PROJECT_SOURCE_DIR}/src/*.c  
		        ${PROJECT_SOURCE_DIR}/src/*.cpp  
		)  
		  
		# 排除无关目录（按需调整，保留你需要的目录）  
		# 禁止把cmake的目录包含进去，不然会导致main重定义，cmake的build文件夹下有自己的main文件
		list(FILTER SRC_LIST EXCLUDE REGEX "${PROJECT_SOURCE_DIR}/cmake-build-debug/.*")  
		list(FILTER SRC_LIST EXCLUDE REGEX "${PROJECT_SOURCE_DIR}/lib/.*")  
		list(FILTER SRC_LIST EXCLUDE REGEX "${PROJECT_SOURCE_DIR}/third_party/.*")  
		list(FILTER SRC_LIST EXCLUDE REGEX "${PROJECT_SOURCE_DIR}/examples/.*")  
		list(FILTER SRC_LIST EXCLUDE REGEX "${PROJECT_SOURCE_DIR}/tools/.*")  
		  
		# 编译可执行文件（确保所有扫描到的 .cpp 中仅有一个 main 函数）  
		add_executable(gcx_muduo ${SRC_LIST})  
		  
		# （可选）编译动态库（排除 main.cpp）  
		# add_library(gcx_muduo SHARED ${SRC_LIST})
	  ```

# cmake-practice

# 1. cmake的是显式假为假，否则是真。以下规则对小写也生效。

- `IF()`里优先解析为变量名,`CMake`会按以下规则判断真假:
    - 假值:`空字符串`、`0`、`OFF`、`NO`、`FALSE`、`N`、`IGNORE`、`NOTFOUND`(或后缀为 `_NOTFOUND`)
    - 真值:除假值外的所有情况(包括`非空字符串`、`1`、`ON`、`YES`、`TRUE`等)

# 2. cmake构建顺序：

1. `cmake -S srcdir -B builddir [-G Ninja]`,根据源码目录和构建目录生成`camke`中间文件。
    - `-G Ninja`是可选项,显式的指定构建工具为`Ninja`。
2. `cmake --build builddir [-j]`,在对应构建目录依据刚生成的中间文件构建。
    - `-j`是指定使用多线程编译，对于`Ninja`只要使用`-j`会自动根据`CPU`选择线程数。
3. 现代`cmake`推荐指令全都小写,但部分系统保留的变量还是大写的。
    - `PROJECT_NAME`是`project`的名字可以手动拼接生成自己的可执行文件名。
4. ```cmake
    cmake_minimum_required(VERSION 3.10)
    project(test)
    #打印二进制目录，使用的是camke保留变量
    message(STATUS "This is BINARY dir " ${PROJECT_BINARY_DIR})
    add_executable(${PROJECT_NAME}_1 main.c)
    #最终会生成一个名为test_1的可执行文件
   ```

# 3. 多级目录的项目

- `add_subdirectory(subdir [output_dir] [EXCLUDE_FROM_ALL])`,添加子目录到整个项目，对应的子目录也需要有自己的
  `CMakeLists.txt`文件
    - `subdir`是源码所在目录。
    - `output_dir`是对应的源码编译产物输出目录，若不指定默认会在`build`目录下创建一个`subdir`同名目录。
    - `EXCLUDE_FROM_ALL`标识意思是不参与编译，常用于对`test`测试用例做剔除，缺省的话，默认是参与编译的。

# 4. 设置输出路径

- `SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)`,设置全局的库输出目录。
- `SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)`,设置全局的可执行文件输出目录。

# 5. 调用外部环境变量

- `$ENV{ENV_NAME}`,可以获取环境中名改为`ENV_NAME`的变量的值。
    - 对于普通变量使用其值只需要`${NAME}`,对于环境变量必须使用`$ENV{NAME}`的形式。



